import{s as e}from"./index-b309e1nc.js";import"./charts-0jYrCXCa.js";import"./qr-BITZ6EfA.js";const t=()=>{const e=new URLSearchParams(window.location.search);return{utm_source:e.get("utm_source")||void 0,utm_medium:e.get("utm_medium")||void 0,utm_campaign:e.get("utm_campaign")||void 0,utm_content:e.get("utm_content")||void 0,utm_term:e.get("utm_term")||void 0}},i=e=>{Object.values(e).some(e=>void 0!==e)&&sessionStorage.setItem("eventnexus_utm",JSON.stringify(e))},s=async s=>{try{const o=t();if(!o.utm_campaign)return;i(o);const r=(()=>{let e=sessionStorage.getItem("eventnexus_session_id");return e||(e=`session_${Date.now()}_${crypto.randomUUID()}`,sessionStorage.setItem("eventnexus_session_id",e)),e})(),a=(()=>{const e=navigator.userAgent;let t="desktop";/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?t="mobile":/Tablet|iPad/.test(e)&&(t="tablet");let i="unknown";e.includes("Chrome")?i="Chrome":e.includes("Safari")?i="Safari":e.includes("Firefox")?i="Firefox":e.includes("Edge")&&(i="Edge");let s="unknown";return e.includes("Windows")?s="Windows":e.includes("Mac")?s="macOS":e.includes("Linux")?s="Linux":e.includes("Android")?s="Android":e.includes("iOS")&&(s="iOS"),{deviceType:t,browser:i,os:s}})(),{data:m}=await e.from("utm_sessions").select("id").eq("session_id",r).single();if(m)return void(await e.from("utm_sessions").update({last_activity_at:(new Date).toISOString(),user_id:s}).eq("session_id",r));await e.from("utm_sessions").insert({session_id:r,user_id:s,utm_source:o.utm_source,utm_medium:o.utm_medium,utm_campaign:o.utm_campaign,utm_content:o.utm_content,utm_term:o.utm_term,landing_page:window.location.href,referrer:document.referrer||null,device_type:a.deviceType,browser:a.browser,os:a.os,first_visit_at:(new Date).toISOString()}),o.utm_campaign&&await n(o.utm_campaign,o.utm_source)}catch(o){}},n=async(t,i)=>{try{const{data:s}=await e.from("campaigns").select("id").eq("trackingCode",t).single();if(!s)return;await e.from("campaign_analytics").insert({campaign_id:s.id,impressions:1,source:i||"direct",medium:"social",recorded_at:(new Date).toISOString()})}catch(s){}};export{t as getUTMParams,s as initializeTracking,i as storeUTMParams,n as trackCampaignImpression};
