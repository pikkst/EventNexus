import{c as e,j as t,a2 as s,q as a,a9 as l,u as r,aa as n,$ as i,a8 as o,h as c,T as d}from"./index-b309e1nc.js";import{b as x}from"./charts-0jYrCXCa.js";import{g as m}from"./ticketService-O5k76BGT.js";import{M as u}from"./message-square-CNN38snK.js";import{A as h}from"./arrow-left-XpV3ECAJ.js";import{M as b}from"./map-pin-Zr57KGRe.js";import{C as p}from"./circle-x-6_o0yPnH.js";import{D as g}from"./download-B9c36Fle.js";import{S as f}from"./share-2-ytQz_KfA.js";import{C as j}from"./clock-Cnt1qgag.js";import{C as v}from"./circle-check-big-BVKQvehI.js";import"./qr-BITZ6EfA.js";import"./browser-D7w79axB.js";
/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=e("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),N=({organizerId:e,organizerName:r,eventId:n,onClose:i,onSuccess:o})=>{const[c,d]=x.useState(0),[m,h]=x.useState(0),[b,p]=x.useState(""),[g,f]=x.useState({organization:0,venue:0,communication:0,value:0}),[j,v]=x.useState(!1),w=({label:e,value:s,onChange:a})=>t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("label",{className:"text-sm font-medium text-slate-300",children:e}),t.jsxs("span",{className:"text-xs text-slate-500",children:[s,"/5"]})]}),t.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(e=>t.jsx("button",{type:"button",onClick:()=>a(e),className:"w-10 h-10 rounded-lg border-2 transition-all "+(e<=s?"border-indigo-500 bg-indigo-500/20 text-indigo-400":"border-slate-700 hover:border-slate-600"),children:t.jsx("span",{className:"text-xs font-bold",children:e})},e))})]});return t.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-[40px] max-w-2xl w-full p-8 relative max-h-[90vh] overflow-y-auto",children:[t.jsx("button",{onClick:i,className:"absolute top-6 right-6 text-slate-400 hover:text-white transition-colors",disabled:j,children:t.jsx("span",{className:"text-3xl",children:"Ã—"})}),t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("h2",{className:"text-3xl font-black text-white mb-2",children:"Rate Your Experience"}),t.jsxs("p",{className:"text-slate-400",children:["How was ",t.jsx("span",{className:"text-white font-bold",children:r}),"?"]})]}),t.jsxs("div",{className:"mb-8 text-center",children:[t.jsx("label",{className:"block text-sm font-bold text-slate-400 uppercase tracking-wider mb-4",children:"Overall Rating"}),t.jsx("div",{className:"flex items-center justify-center gap-2",children:[1,2,3,4,5].map(e=>t.jsx("button",{type:"button",onClick:()=>d(e),onMouseEnter:()=>h(e),onMouseLeave:()=>h(0),className:"transition-transform hover:scale-110",children:t.jsx(s,{size:48,className:(e<=(m||c)?"fill-yellow-400 text-yellow-400":"text-slate-700")+" transition-colors"})},e))}),c>0&&t.jsxs("p",{className:"text-sm text-slate-400 mt-4",children:[5===c&&"ðŸŽ‰ Amazing!",4===c&&"ðŸ˜Š Great!",3===c&&"ðŸ‘ Good",2===c&&"ðŸ˜ Could be better",1===c&&"ðŸ˜ž Not satisfied"]})]}),t.jsxs("div",{className:"space-y-6 mb-8 p-6 bg-slate-950/50 rounded-3xl border border-slate-800",children:[t.jsx("h3",{className:"text-sm font-bold text-slate-300 uppercase tracking-wider mb-4",children:"Rate Specific Aspects (Optional)"}),t.jsx(w,{label:"Organization & Planning",value:g.organization,onChange:e=>f({...g,organization:e})}),t.jsx(w,{label:"Venue & Facilities",value:g.venue,onChange:e=>f({...g,venue:e})}),t.jsx(w,{label:"Communication",value:g.communication,onChange:e=>f({...g,communication:e})}),t.jsx(w,{label:"Value for Money",value:g.value,onChange:e=>f({...g,value:e})})]}),t.jsxs("div",{className:"mb-8",children:[t.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold text-slate-400 uppercase tracking-wider mb-3",children:[t.jsx(u,{size:16}),"Your Review (Optional)"]}),t.jsx("textarea",{value:b,onChange:e=>p(e.target.value),placeholder:"Share your experience with others...",rows:4,maxLength:500,className:"w-full bg-slate-950 border border-slate-800 rounded-2xl px-5 py-4 text-white outline-none focus:border-indigo-500 resize-none"}),t.jsxs("div",{className:"text-right text-xs text-slate-500 mt-2",children:[b.length,"/500"]})]}),t.jsx("button",{onClick:async()=>{if(0!==c){v(!0);try{await l(e,c,n,b||void 0,g)?(alert("âœ“ Thank you for your feedback!"),null==o||o(),i()):alert("Failed to submit rating. Please try again.")}catch(t){alert("An error occurred. Please try again.")}finally{v(!1)}}else alert("Please select a rating")},disabled:0===c||j,className:"w-full py-5 rounded-2xl font-black text-sm uppercase tracking-wider transition-all flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg shadow-indigo-600/20",children:j?t.jsx(t.Fragment,{children:"Processing..."}):t.jsxs(t.Fragment,{children:[t.jsx(a,{size:18}),"Submit Rating"]})})]})})},y=()=>{var e,a,l,u,y,k,C;const S=r(),z=n(),E=i(),[T,R]=x.useState((null==(e=z.state)?void 0:e.ticket)||null),[P,_]=x.useState(null),[M,F]=x.useState(!0),[L,$]=x.useState(!1);x.useEffect(()=>{!T&&E.id&&(async()=>{const e=await o(E.id);e&&R(e)})()},[E.id,T]),x.useEffect(()=>{if(!T)return;return(async()=>{try{const e=await m(T.id,T.event_id,T.user_id);_(e)}catch(e){}finally{F(!1)}})(),document.body.style.filter="brightness(1.1)",()=>{document.body.style.filter=""}},[T]),x.useEffect(()=>{const e=e=>{"Escape"===e.key&&S("/profile")};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[S]);return T?t.jsxs("div",{className:"min-h-screen bg-slate-950",children:[t.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("button",{onClick:()=>S("/profile"),className:"flex items-center gap-2 text-slate-400 hover:text-white",children:[t.jsx(h,{className:"w-5 h-5"})," Back"]}),t.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-full border text-sm font-bold uppercase tracking-wider ${(()=>{switch(null==T?void 0:T.status){case"valid":return"text-emerald-500 bg-emerald-500/10 border-emerald-500/20";case"used":default:return"text-slate-500 bg-slate-500/10 border-slate-500/20";case"cancelled":return"text-red-500 bg-red-500/10 border-red-500/20";case"expired":return"text-orange-500 bg-orange-500/10 border-orange-500/20"}})()}`,children:[(()=>{switch(null==T?void 0:T.status){case"valid":case"used":return t.jsx(v,{className:"w-5 h-5"});case"cancelled":return t.jsx(p,{className:"w-5 h-5"});case"expired":return t.jsx(j,{className:"w-5 h-5"});default:return t.jsx(d,{className:"w-5 h-5"})}})(),T.status]})]}),t.jsxs("div",{className:"relative h-40 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-2xl overflow-hidden mb-6",children:[(null==(a=T.event)?void 0:a.imageUrl)&&t.jsx("img",{src:T.event.imageUrl,alt:T.event.name,className:"absolute inset-0 w-full h-full object-cover opacity-60"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-transparent"}),t.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:t.jsx("h2",{className:"text-white font-black text-2xl leading-tight",children:null==(l=T.event)?void 0:l.name})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[t.jsx(c,{className:"w-4 h-4"}),t.jsxs("span",{children:[(D=null==(u=T.event)?void 0:u.date,new Date(D).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"}))," at ",null==(y=T.event)?void 0:y.time]})]}),(null==(k=T.event)?void 0:k.location)&&t.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[t.jsx(b,{className:"w-4 h-4"}),t.jsx("span",{children:T.event.location.address||T.event.location.city})]})]}),"valid"===T.status&&t.jsx("div",{className:"bg-white p-6 rounded-2xl",children:M?t.jsx("div",{className:"w-full aspect-square flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-indigo-600"})}):P?t.jsxs("div",{className:"space-y-4",children:[t.jsx("img",{src:P,alt:"Ticket QR Code",className:"w-full h-auto max-w-md mx-auto"}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-sm text-slate-600 font-bold uppercase tracking-wider mb-2",children:"Scan this code at venue entrance"}),t.jsxs("p",{className:"text-xs text-slate-500 font-mono",children:["ID: ",T.qr_code.substring(0,16),"..."]})]})]}):t.jsx("div",{className:"w-full aspect-square flex items-center justify-center text-slate-400",children:t.jsxs("div",{className:"text-center",children:[t.jsx(p,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),t.jsx("p",{className:"font-bold",children:"QR Code Generation Error"})]})})}),"used"===T.status&&T.used_at&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-xl p-4",children:t.jsxs("p",{className:"text-slate-300 font-semibold",children:["âœ“ Ticket scanned on ",new Date(T.used_at).toLocaleString()]})}),t.jsxs("button",{onClick:()=>$(!0),className:"w-full flex items-center justify-center gap-2 px-6 py-4 bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white rounded-xl font-bold transition-all shadow-lg",children:[t.jsx(s,{className:"w-5 h-5 fill-current"}),"Rate This Organizer"]})]}),"cancelled"===T.status&&t.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-4",children:t.jsx("p",{className:"text-red-400 font-semibold",children:"âš  This ticket has been cancelled and is no longer valid."})}),"expired"===T.status&&t.jsx("div",{className:"bg-orange-500/10 border border-orange-500/30 rounded-xl p-4",children:t.jsx("p",{className:"text-orange-400 font-semibold",children:"â± This ticket has expired."})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-slate-800",children:[t.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[t.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wider font-bold mb-1",children:"Ticket Type"}),t.jsx("p",{className:"text-lg font-bold text-white capitalize",children:T.ticket_type})]}),t.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[t.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-wider font-bold mb-1",children:"Price Paid"}),t.jsx("p",{className:"text-lg font-bold text-white",children:(q=T.price,0===q?"FREE":`â‚¬${q.toFixed(2)}`)})]})]}),"valid"===T.status&&P&&t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsxs("button",{onClick:()=>window.print(),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-bold transition-colors border border-slate-700",children:[t.jsx(w,{className:"w-5 h-5"}),"Print"]}),t.jsxs("button",{onClick:()=>{if(!P)return;const e=document.createElement("a");e.href=P,e.download=`ticket-${T.id}.png`,e.click()},className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-bold transition-colors border border-slate-700",children:[t.jsx(g,{className:"w-5 h-5"}),"Download"]}),t.jsxs("button",{onClick:async()=>{var e;if(P)try{const t=await fetch(P),s=await t.blob(),a=new File([s],`ticket-${T.id}.png`,{type:"image/png"});navigator.share&&(null==(e=navigator.canShare)?void 0:e.call(navigator,{files:[a]}))?await navigator.share({title:`Ticket for ${T.event.name}`,text:`My ticket for ${T.event.name}`,files:[a]}):alert("Ticket QR code ready to share! Use the download button to save it.")}catch(t){}},className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold transition-colors",children:[t.jsx(f,{className:"w-5 h-5"}),"Share"]})]})]})]}),L&&(null==(C=null==T?void 0:T.event)?void 0:C.organizer_id)&&t.jsx(N,{organizerId:T.event.organizer_id,organizerName:T.event.organizer_name||"Organizer",eventId:T.event_id,onClose:()=>$(!1),onSuccess:()=>{alert("Thank you for your feedback!")}})]}):(x.useEffect(()=>{S("/profile")},[S]),t.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-12",children:[t.jsxs("button",{onClick:()=>S("/profile"),className:"flex items-center gap-2 text-slate-400 hover:text-white",children:[t.jsx(h,{className:"w-4 h-4"})," Back to Profile"]}),t.jsx("div",{className:"mt-6 text-slate-300",children:"No ticket selected."})]}));var q,D};export{y as default};
