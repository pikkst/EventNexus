import{s as e}from"./index-b309e1nc.js";import{g as t}from"./geminiService-DURgciVI.js";import"./charts-0jYrCXCa.js";import"./qr-BITZ6EfA.js";const r=async t=>{try{const[,r]=t.split(","),n=atob(r),o=new Uint8Array(n.length);for(let e=0;e<n.length;e++)o[e]=n.charCodeAt(e);const a=new Blob([o],{type:"image/png"}),s=`instagram/${Date.now()}-${Math.random().toString(36).slice(2,10)}.png`,{error:i}=await e.storage.from("social-media").upload(s,a,{cacheControl:"3600",upsert:!0,contentType:"image/png"});if(i)return null;const{data:c}=e.storage.from("social-media").getPublicUrl(s);return(null==c?void 0:c.publicUrl)||null}catch(r){return null}},n=async(e,r,n,o,a)=>{const s="https://eventnexus.eu",i=`${o}-FB`,c=`${o}-IG`,m=`${o}-TW`,d=`${o}-LI`,u=`${s}?utm_source=facebook&utm_campaign=${i}`,g=`${s}?utm_source=instagram&utm_campaign=${c}`,l=`${s}?utm_source=twitter&utm_campaign=${m}`,p=`${s}?utm_source=linkedin&utm_campaign=${d}`,[h,w,k,f]=await Promise.all([t(a,"16:9",!0),t(a,"1:1",!0),t(a,"16:9",!0),t(a,"16:9",!0)]);return{facebook:{content:`ðŸŽ‰ ${e}\n\n${r}\n\n${n} ðŸ‘‰`,hashtags:["EventNexus","Events","Community"],imageUrl:h||void 0,trackingUrl:u,trackingCode:i},instagram:{caption:`${e}\n\n${r}\n\n${n} - Link in bio! ðŸ’«`,hashtags:["EventNexus","Events","Community","EventPlanning","LocalEvents"],imageUrl:w||void 0,trackingUrl:g,trackingCode:c},twitter:{tweet:`${e}\n\n${r}\n\n${n} ðŸ‘‡`,hashtags:["EventNexus","Events"],imageUrl:k||void 0,trackingUrl:l,trackingCode:m},linkedin:{content:`${e}\n\n${r}\n\n${n}\n\nDiscover events that matter.`,imageUrl:f||void 0,trackingUrl:p,trackingCode:d}}},o=(e,t,r,n)=>{const o=`https://eventnexus.eu?utm_source=social&utm_campaign=${n}`;return{facebook:{content:`ðŸŽ‰ ${e}\n\n${t}\n\n${r} ðŸ‘‰ ${o}`,hashtags:["EventNexus","Events","Community"],imageUrl:void 0},instagram:{caption:`${e}\n\n${t}\n\n${r} - Link in bio!\n\n`,hashtags:["EventNexus","Events","Community","EventPlanning","LocalEvents"],imageUrl:void 0},twitter:{tweet:`${e}\n\n${t}\n\n${r} ðŸ‘‡\n${o}`,hashtags:["EventNexus","Events"],imageUrl:void 0},linkedin:{content:`${e}\n\n${t}\n\n${r}\n\n${o}`,imageUrl:void 0}}},a=async(e,t,r,n,o)=>{try{if(!t)throw new Error("Facebook Page ID is required");if(n){let a;if(!n.startsWith("data:")){const a={url:n,message:r,access_token:e};o&&(a.link=o);const s=await fetch(`https://graph.facebook.com/v18.0/${t}/photos`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),i=await s.json();if(i.error){if(190===i.error.code)throw new Error("Facebook access token has expired. Please reconnect your Facebook account.");throw new Error(i.error.message||"Facebook photo posting failed")}return{success:!0,postId:i.id,error:void 0}}{const e=n.split(",")[1],t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);a=new Blob([r],{type:"image/png"})}const s=new FormData;s.append("source",a,"ad-image.png"),s.append("message",r),s.append("access_token",e),o&&s.append("link",o);const i=await fetch(`https://graph.facebook.com/v18.0/${t}/photos`,{method:"POST",body:s}),c=await i.json();if(c.error){if(190===c.error.code)throw new Error("Facebook access token has expired. Please reconnect your Facebook account.");throw new Error(c.error.message||"Facebook photo posting failed")}return{success:!0,postId:c.id,error:void 0}}const a={message:r,access_token:e};o&&(a.link=o);const s=await fetch(`https://graph.facebook.com/v18.0/${t}/feed`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),i=await s.json();if(i.error){if(190===i.error.code)throw new Error("Facebook access token has expired. Please reconnect your Facebook account.");throw new Error(i.error.message||"Facebook posting failed")}return{success:!0,postId:i.id,error:void 0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error"}}},s=async(e,t,n,o)=>{try{if(!t)throw new Error("Instagram Business Account ID is required");let a=o;if(!a)throw new Error("Instagram requires an image");if(a.startsWith("data:")){const e=await r(a);if(!e)throw new Error("Failed to upload image for Instagram. Please retry.");a=e}const s=await fetch(`https://graph.facebook.com/v18.0/${t}/media`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_url:a,caption:n,access_token:e})}),i=await s.json();if(i.error)throw new Error(i.error.message||"Failed to create Instagram media container");await new Promise(e=>setTimeout(e,3e3));const c=await fetch(`https://graph.facebook.com/v18.0/${i.id}?fields=status_code&access_token=${e}`),m=await c.json();if("FINISHED"!==m.status_code&&"IN_PROGRESS"!==m.status_code)throw new Error(`Container not ready: ${m.status_code||"unknown status"}`);const d=await fetch(`https://graph.facebook.com/v18.0/${t}/media_publish`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({creation_id:i.id,access_token:e})}),u=await d.json();if(u.error)throw new Error(u.error.message||"Failed to publish Instagram post");return{success:!0,postId:u.id,error:void 0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error"}}},i=async(e,t,r)=>{try{return{success:!0,postId:`tw_${Date.now()}`,error:void 0}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}},c=async(e,t,r,n)=>{try{return{success:!0,postId:`li_${Date.now()}`,error:void 0}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Unknown error"}}},m=async(t,r,n)=>{try{const{error:o}=await e.from("social_media_posts").insert({user_id:t,campaign_id:r,platform:n.platform,content:n.content,image_url:n.imageUrl,scheduled_at:n.scheduledAt,status:n.status});if(o)throw o;return!0}catch(o){return!1}},d=async t=>{try{const{data:r,error:n}=await e.from("social_media_accounts").select("*").eq("user_id",t).eq("is_connected",!0);if(n)throw n;return(r||[]).map(e=>({platform:e.platform,accountId:e.account_id,accountName:e.account_name,accessToken:e.access_token,refreshToken:e.refresh_token,expiresAt:e.expires_at,isConnected:e.is_connected}))}catch(r){return[]}},u=async(e,t,r,n)=>{const o=await d(e),m={};for(const d of o){let e;switch(d.platform){case"facebook":r.facebook&&(e=await a(d.accessToken,d.accountId,r.facebook.content,n||r.facebook.imageUrl),m.facebook=e);break;case"instagram":r.instagram&&n&&(e=await s(d.accessToken,d.accountId,r.instagram.caption,n),m.instagram=e);break;case"twitter":r.twitter&&(e=await i(d.accessToken,r.twitter.tweet,n||r.twitter.imageUrl),m.twitter=e);break;case"linkedin":r.linkedin&&(e=await c(d.accessToken,d.accountId,r.linkedin.content,n||r.linkedin.imageUrl),m.linkedin=e)}}return m},g=(e,t,r,n,a)=>{const s=o(e,t,r,n);return a&&(s.facebook&&(s.facebook.imageUrl=a),s.instagram&&(s.instagram.imageUrl=a),s.twitter&&(s.twitter.imageUrl=a),s.linkedin&&(s.linkedin.imageUrl=a)),s};export{u as bulkPostCampaign,o as generateSocialMediaContent,n as generateSocialMediaContentWithImages,d as getConnectedAccounts,a as postToFacebook,s as postToInstagram,c as postToLinkedIn,i as postToTwitter,g as previewCampaignPosts,m as scheduleSocialPost};
