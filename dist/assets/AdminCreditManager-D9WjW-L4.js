import{c as e,b1 as t,b2 as s,b3 as a,b4 as r,j as l,M as n,b5 as i,m as c,au as d,x as o,b6 as x,b7 as m,b8 as u,b9 as p}from"./index-b309e1nc.js";import{b as g}from"./charts-0jYrCXCa.js";import{R as h}from"./refresh-cw-hkacKNH8.js";import{C as y}from"./circle-check-big-BVKQvehI.js";import{C as f}from"./circle-alert-_cpfBv0g.js";import{C as b}from"./code-BJlMwBF-.js";import{D as j}from"./download-B9c36Fle.js";import{S as v}from"./search-Bhl9FGOw.js";import{C as N}from"./circle-x-6_o0yPnH.js";import"./qr-BITZ6EfA.js";
/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=e("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),C=e("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),k=({user:e})=>{const[k,S]=g.useState("grant"),[_,U]=g.useState([]),[T,A]=g.useState([]),[L,R]=g.useState([]),[D,F]=g.useState([]),[I,E]=g.useState(!1),[M,P]=g.useState(null),[G,$]=g.useState(""),[O,B]=g.useState(""),[V,q]=g.useState(""),[z,W]=g.useState("promo"),[H,J]=g.useState("basic"),[K,Q]=g.useState("100"),[X,Y]=g.useState("1"),[Z,ee]=g.useState(""),[te,se]=g.useState("1"),[ae,re]=g.useState(""),[le,ne]=g.useState(""),[ie,ce]=g.useState("all"),[de,oe]=g.useState("all");g.useEffect(()=>{xe()},[]);const xe=async()=>{E(!0);try{const[e,l,n,i]=await Promise.all([t(),s(),a(),r()]);U(e),A(l),R(n),F(i)}catch(e){me("error","Failed to load data")}finally{E(!1)}},me=(e,t)=>{P({type:e,text:t}),setTimeout(()=>P(null),5e3)},ue=()=>_.filter(e=>{const t=e.code.toLowerCase().includes(le.toLowerCase()),s="all"===ie||e.code_type===ie,a="all"===de||"active"===de&&e.is_active||"inactive"===de&&!e.is_active;return t&&s&&a}),pe=e=>{switch(e){case"free":default:return"bg-gray-100 text-gray-800";case"basic":return"bg-blue-100 text-blue-800";case"pro":return"bg-purple-100 text-purple-800";case"enterprise":return"bg-orange-100 text-orange-800"}},ge=e=>{switch(e){case"admin_grant":return"bg-green-100 text-green-800";case"code_redemption":return"bg-blue-100 text-blue-800";case"purchase":return"bg-purple-100 text-purple-800";case"refund":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return l.jsx("div",{className:"max-w-7xl mx-auto p-6",children:l.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[l.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-2 bg-gradient-to-br from-orange-500 to-pink-500 rounded-lg",children:l.jsx(n,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Credit Manager"}),l.jsx("p",{className:"text-sm text-gray-600",children:"Manage credits and promotional codes"})]})]}),l.jsxs("button",{onClick:xe,disabled:I,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50",children:[l.jsx(h,{className:"w-4 h-4 "+(I?"animate-spin":"")}),"Refresh"]})]})}),M&&l.jsx("div",{className:"px-6 py-3 "+("success"===M.type?"bg-green-50 text-green-800":"bg-red-50 text-red-800"),children:l.jsxs("div",{className:"flex items-center gap-2",children:["success"===M.type?l.jsx(y,{className:"w-5 h-5"}):l.jsx(f,{className:"w-5 h-5"}),l.jsx("p",{className:"text-sm font-medium",children:M.text})]})}),l.jsx("div",{className:"border-b border-gray-200",children:l.jsx("nav",{className:"flex px-6","aria-label":"Tabs",children:[{id:"grant",label:"Grant Credits",icon:i},{id:"generate",label:"Generate Codes",icon:b},{id:"codes",label:"Manage Codes",icon:n},{id:"transactions",label:"Transactions",icon:c}].map(e=>l.jsxs("button",{onClick:()=>S(e.id),className:"flex items-center gap-2 px-4 py-4 text-sm font-medium border-b-2 transition-colors "+(k===e.id?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[l.jsx(e.icon,{className:"w-4 h-4"}),e.label]},e.id))})}),l.jsxs("div",{className:"p-6",children:["grant"===k&&l.jsxs("div",{className:"max-w-2xl",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Grant Credits to User"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select User"}),l.jsxs("select",{value:G,onChange:e=>$(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"-- Select a user --"}),D.map(e=>l.jsxs("option",{value:e.id,children:[e.name," (",e.email,") - Current: ",e.credits||0," credits"]},e.id))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Credit Amount (positive to add, negative to remove)"}),l.jsx("input",{type:"number",value:O,onChange:e=>B(e.target.value),placeholder:"e.g., 100 or -50",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason"}),l.jsx("textarea",{value:V,onChange:e=>q(e.target.value),placeholder:"Explain why credits are being granted or removed",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),l.jsxs("button",{onClick:async()=>{if(!G||!O||!V)return void me("error","Please fill in all fields");const t=parseInt(O);if(isNaN(t)||0===t)me("error","Invalid credit amount");else{E(!0);try{const s=await x(G,t,V,e.id);s.success?(me("success",`Successfully granted ${t} credits. New balance: ${s.new_balance}`),$(""),B(""),q(""),xe()):me("error",s.error||"Failed to grant credits")}catch(s){me("error","Failed to grant credits")}finally{E(!1)}}},disabled:I||!G||!O||!V,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-orange-500 to-pink-500 text-white rounded-lg hover:from-orange-600 hover:to-pink-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[l.jsx(d,{className:"w-5 h-5"}),"Grant Credits"]})]})]}),"generate"===k&&l.jsxs("div",{className:"max-w-2xl",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Generate Promo/Reward Codes"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Code Type"}),l.jsxs("select",{value:z,onChange:e=>W(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[l.jsx("option",{value:"promo",children:"Promo (for registration)"}),l.jsx("option",{value:"reward",children:"Reward (for existing users)"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tier"}),l.jsxs("select",{value:H,onChange:e=>J(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[l.jsx("option",{value:"free",children:"Free"}),l.jsx("option",{value:"basic",children:"Basic"}),l.jsx("option",{value:"pro",children:"Pro"}),l.jsx("option",{value:"enterprise",children:"Enterprise"})]})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Credit Amount"}),l.jsx("input",{type:"number",value:K,onChange:e=>Q(e.target.value),min:"1",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Uses (blank for unlimited)"}),l.jsx("input",{type:"number",value:X,onChange:e=>Y(e.target.value),min:"1",placeholder:"Unlimited",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Codes"}),l.jsx("input",{type:"number",value:te,onChange:e=>se(e.target.value),min:"1",max:"100",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valid Until (optional)"}),l.jsx("input",{type:"datetime-local",value:Z,onChange:e=>ee(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Code Prefix (optional)"}),l.jsx("input",{type:"text",value:ae,onChange:e=>re(e.target.value.toUpperCase()),placeholder:"e.g., WELCOME",maxLength:10,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),l.jsxs("button",{onClick:async()=>{const e=parseInt(K),t=parseInt(te),s=X?parseInt(X):null;if(isNaN(e)||e<=0)me("error","Invalid credit amount");else if(isNaN(t)||t<=0||t>100)me("error","Count must be between 1 and 100");else{E(!0);try{const a=await m({codeType:z,tier:H,creditAmount:e,maxUses:s,validUntil:Z||void 0,count:t,prefix:ae||void 0});a.length>0?(me("success",`Successfully generated ${a.length} codes`),Q("100"),Y("1"),ee(""),se("1"),re(""),xe()):me("error","Failed to generate codes")}catch(a){me("error","Failed to generate codes")}finally{E(!1)}}},disabled:I,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-orange-500 to-pink-500 text-white rounded-lg hover:from-orange-600 hover:to-pink-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[l.jsx(b,{className:"w-5 h-5"}),"Generate Codes"]})]})]}),"codes"===k&&l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsx("h2",{className:"text-lg font-semibold",children:"Manage Codes"}),l.jsxs("button",{onClick:()=>{const e=ue(),t=[["Code","Type","Tier","Credits","Max Uses","Current Uses","Status","Valid Until"].join(","),...e.map(e=>[e.code,e.code_type,e.tier,e.credit_amount,e.max_uses||"Unlimited",e.current_uses,e.is_active?"Active":"Inactive",e.valid_until?new Date(e.valid_until).toLocaleDateString():"No expiry"].join(","))].join("\n"),s=new Blob([t],{type:"text/csv"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`promo-codes-${(new Date).toISOString().split("T")[0]}.csv`,r.click(),URL.revokeObjectURL(a)},className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:[l.jsx(j,{className:"w-4 h-4"}),"Export CSV"]})]}),l.jsxs("div",{className:"flex gap-4 mb-6",children:[l.jsx("div",{className:"flex-1",children:l.jsxs("div",{className:"relative",children:[l.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),l.jsx("input",{type:"text",value:le,onChange:e=>ne(e.target.value),placeholder:"Search codes...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]})}),l.jsxs("select",{value:ie,onChange:e=>ce(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[l.jsx("option",{value:"all",children:"All Types"}),l.jsx("option",{value:"promo",children:"Promo"}),l.jsx("option",{value:"reward",children:"Reward"})]}),l.jsxs("select",{value:de,onChange:e=>oe(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[l.jsx("option",{value:"all",children:"All Status"}),l.jsx("option",{value:"active",children:"Active"}),l.jsx("option",{value:"inactive",children:"Inactive"})]})]}),l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("table",{className:"w-full",children:[l.jsx("thead",{className:"bg-gray-50",children:l.jsxs("tr",{children:[l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Code"}),l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tier"}),l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credits"}),l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uses"}),l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expires"}),l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),l.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ue().map(e=>l.jsxs("tr",{className:"hover:bg-gray-50",children:[l.jsx("td",{className:"px-4 py-4",children:l.jsx("code",{className:"text-sm font-mono bg-gray-100 px-2 py-1 rounded",children:e.code})}),l.jsx("td",{className:"px-4 py-4",children:l.jsx("span",{className:"text-sm capitalize",children:e.code_type})}),l.jsx("td",{className:"px-4 py-4",children:l.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${pe(e.tier)}`,children:e.tier})}),l.jsx("td",{className:"px-4 py-4 text-sm",children:e.credit_amount}),l.jsxs("td",{className:"px-4 py-4 text-sm",children:[e.current_uses,"/",e.max_uses||"âˆž"]}),l.jsx("td",{className:"px-4 py-4",children:e.is_active?l.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 text-sm",children:[l.jsx(y,{className:"w-4 h-4"}),"Active"]}):l.jsxs("span",{className:"inline-flex items-center gap-1 text-gray-600 text-sm",children:[l.jsx(N,{className:"w-4 h-4"}),"Inactive"]})}),l.jsx("td",{className:"px-4 py-4 text-sm text-gray-600",children:e.valid_until?new Date(e.valid_until).toLocaleDateString():"Never"}),l.jsx("td",{className:"px-4 py-4",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("button",{onClick:()=>(async(e,t)=>{E(!0);try{await u(e,!t)?(me("success","Code "+(t?"deactivated":"activated")),xe()):me("error","Failed to update code status")}catch(s){me("error","Failed to update code status")}finally{E(!1)}})(e.id,e.is_active),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:e.is_active?"Deactivate":"Activate",children:e.is_active?l.jsx(C,{className:"w-5 h-5 text-green-600"}):l.jsx(w,{className:"w-5 h-5 text-gray-400"})}),l.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this code?")){E(!0);try{await p(e)?(me("success","Code deleted successfully"),xe()):me("error","Failed to delete code")}catch(t){me("error","Failed to delete code")}finally{E(!1)}}})(e.id),className:"p-1 hover:bg-red-50 rounded transition-colors",title:"Delete",children:l.jsx(o,{className:"w-5 h-5 text-red-600"})})]})})]},e.id))})]})}),0===ue().length&&l.jsxs("div",{className:"text-center py-12",children:[l.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600",children:"No codes found"})]})]}),"transactions"===k&&l.jsxs("div",{children:[l.jsx("h2",{className:"text-lg font-semibold mb-6",children:"Credit Transactions"}),l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("table",{className:"w-full",children:[l.jsx("thead",{className:"bg-gray-50",children:l.jsxs("tr",{children:[l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Balance After"}),l.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"})]})}),l.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:L.map(e=>{const t=D.find(t=>t.id===e.user_id);return l.jsxs("tr",{className:"hover:bg-gray-50",children:[l.jsx("td",{className:"px-4 py-4 text-sm text-gray-600",children:new Date(e.created_at).toLocaleString()}),l.jsx("td",{className:"px-4 py-4 text-sm",children:(null==t?void 0:t.name)||"Unknown User"}),l.jsx("td",{className:"px-4 py-4",children:l.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${ge(e.transaction_type)}`,children:e.transaction_type.replace("_"," ")})}),l.jsxs("td",{className:"px-4 py-4 text-sm font-semibold "+(e.amount>=0?"text-green-600":"text-red-600"),children:[e.amount>=0?"+":"",e.amount]}),l.jsx("td",{className:"px-4 py-4 text-sm font-medium",children:e.balance_after}),l.jsx("td",{className:"px-4 py-4 text-sm text-gray-600",children:e.reason||"-"})]},e.id)})})]})}),0===L.length&&l.jsxs("div",{className:"text-center py-12",children:[l.jsx(c,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600",children:"No transactions yet"})]})]})]})]})})};
/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{k as default};
