import{u as e,j as t,a3 as s,X as a,U as l,a7 as r,a8 as n}from"./index-b309e1nc.js";import{b as i}from"./charts-0jYrCXCa.js";import{e as c}from"./qr-BITZ6EfA.js";import{p as d}from"./ticketService-O5k76BGT.js";import{C as o}from"./circle-alert-_cpfBv0g.js";import{C as x}from"./camera-DmA-TvOu.js";import{C as m}from"./circle-check-big-BVKQvehI.js";import{R as u}from"./refresh-cw-hkacKNH8.js";import{I as h}from"./info-DS4ltxwt.js";import"./browser-D7w79axB.js";const b=({user:b})=>{const[p,f]=i.useState(!1),[j,v]=i.useState(null),[g,N]=i.useState(!0),[w,y]=i.useState(!1),[k,C]=i.useState(null),S=i.useRef(null),R=i.useRef(null),A=i.useRef(null),E=e(),T="enterprise"===(null==b?void 0:b.subscription),D=T&&(null==b?void 0:b.branding)?b.branding.primaryColor:"#6366f1",q=async()=>{if(R.current)try{const e=new c(R.current,e=>_(e.data),{returnDetailedScanResult:!0,highlightScanRegion:!0,highlightCodeOutline:!0,preferredCamera:"environment"});A.current=e,await e.start(),f(!0),N(!0)}catch(e){N(!1),f(!1)}},I=()=>{A.current&&(A.current.stop(),A.current.destroy(),A.current=null,f(!1))},_=async e=>{var t,s,a;if(!b)return;const l=Date.now();if(S.current&&S.current.data===e&&l-S.current.ts<3e3)return;if(S.current={data:e,ts:l},w||k)return;I(),C({qrData:e});const r=d(e);if(null==r?void 0:r.ticketId)try{const l=await n(r.ticketId);l&&C({qrData:e,preview:{name:(null==(t=l.user)?void 0:t.name)||"Attendee",email:(null==(s=l.user)?void 0:s.email)||"",eventName:(null==(a=l.event)?void 0:a.name)||"Event"}})}catch(i){}};return i.useEffect(()=>(q(),()=>I()),[]),b?t.jsxs("div",{className:"fixed inset-0 bg-slate-950 z-[100] flex flex-col",children:[t.jsxs("div",{className:"p-6 flex items-center justify-between bg-slate-950/80 backdrop-blur-md border-b border-slate-800",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:D},children:t.jsx(s,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-lg font-black tracking-tighter text-white",children:T?"Branded Entry Control":"Entry Control"}),t.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest",style:{color:D},children:T?null==b?void 0:b.name:"Midnight Techno RAVE"})]})]}),t.jsx("button",{onClick:()=>E("/dashboard"),className:"p-2 hover:bg-slate-800 rounded-xl text-slate-400",children:t.jsx(a,{className:"w-6 h-6"})})]}),t.jsxs("div",{className:"flex-1 relative overflow-hidden bg-black flex items-center justify-center",children:[g?t.jsx("video",{ref:R,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover opacity-60"}):t.jsxs("div",{className:"text-center p-8 space-y-4",children:[t.jsx(o,{className:"w-16 h-16 text-red-500 mx-auto"}),t.jsx("h2",{className:"text-xl font-bold text-white",children:"Camera Access Required"}),t.jsx("p",{className:"text-slate-400 text-sm",children:"Please enable camera permissions in your browser settings to scan tickets."}),t.jsx("button",{onClick:q,className:"px-6 py-3 rounded-xl font-bold text-sm text-white",style:{backgroundColor:D},children:"Grant Access"})]}),t.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col items-center justify-center",children:[t.jsxs("div",{className:"w-64 h-64 border-2 rounded-[40px] relative transition-all duration-700",style:{borderColor:D},children:[t.jsx("div",{className:"absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-white -translate-x-1 -translate-y-1 rounded-tl-xl"}),t.jsx("div",{className:"absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-white translate-x-1 -translate-y-1 rounded-tr-xl"}),t.jsx("div",{className:"absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-white -translate-x-1 translate-y-1 rounded-bl-xl"}),t.jsx("div",{className:"absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-white translate-x-1 translate-y-1 rounded-br-xl"}),t.jsx("div",{className:"absolute inset-x-4 h-0.5 shadow-[0_0_15px_rgba(255,255,255,0.5)] animate-scan-line top-0",style:{backgroundColor:D}})]}),t.jsxs("p",{className:"mt-8 text-white/60 font-bold text-xs uppercase tracking-[0.3em] bg-black/40 px-4 py-2 rounded-full backdrop-blur-md",children:["Align ",T?null==b?void 0:b.name:"Nexus"," Ticket"]})]}),k&&!j&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-6 backdrop-blur-md bg-black/40",children:t.jsxs("div",{className:"w-full max-w-sm bg-slate-900 border border-slate-800 rounded-[32px] p-8 shadow-2xl space-y-6",children:[t.jsxs("div",{className:"flex flex-col items-center text-center",children:[t.jsx(x,{className:"w-14 h-14 text-indigo-400 mb-3"}),t.jsx("h2",{className:"text-2xl font-black tracking-tight text-white",children:"Confirm Check-in"}),t.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"Review attendee before marking ticket as used"})]}),k.preview&&t.jsxs("div",{className:"bg-slate-800/50 rounded-2xl p-4 space-y-3 border border-slate-700",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-white",style:{backgroundColor:D},children:t.jsx(l,{className:"w-5 h-5"})}),t.jsxs("div",{className:"text-left flex-1",children:[t.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:"Attendee"}),t.jsx("p",{className:"font-bold text-white",children:k.preview.name}),k.preview.email&&t.jsx("p",{className:"text-xs text-slate-400",children:k.preview.email})]})]}),k.preview.eventName&&t.jsxs("div",{className:"text-left",children:[t.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:"Event"}),t.jsx("p",{className:"font-bold text-indigo-400",children:k.preview.eventName})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:async()=>{var e,t,s,a,l,n,i,c,d;if(k){y(!0);try{const o=await r(k.qrData);o&&o.valid?v({success:!0,message:o.message||"Access Granted",data:{name:(null==(t=null==(e=o.ticket)?void 0:e.user)?void 0:t.name)||"Attendee",email:(null==(a=null==(s=o.ticket)?void 0:s.user)?void 0:a.email)||"",type:(null==(l=o.ticket)?void 0:l.ticket_type)||"General",eventName:(null==(i=null==(n=o.ticket)?void 0:n.event)?void 0:i.name)||"Event",ref:(null==(c=o.ticket)?void 0:c.id)||"",selfScan:o.selfScan||!1}}):v({success:!1,message:(null==o?void 0:o.message)||(null==o?void 0:o.error)||"Invalid Ticket",data:(null==o?void 0:o.ticket)?{name:(null==(d=o.ticket.user)?void 0:d.name)||"Unknown",status:o.ticket.status}:null})}catch(o){v({success:!1,message:"Validation Error",data:null})}finally{C(null),setTimeout(()=>{v(null),y(!1),q()},4e3)}}},className:"flex-1 px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold",children:"Confirm Check-in"}),t.jsx("button",{onClick:()=>{C(null),setTimeout(()=>q(),300)},className:"flex-1 px-4 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-bold",children:"Cancel"})]})]})}),j&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-6 backdrop-blur-md animate-in fade-in duration-300 "+(j.success?"bg-emerald-500/10":"bg-red-500/10"),children:t.jsxs("div",{className:"w-full max-w-sm bg-slate-900 border border-slate-800 rounded-[32px] p-8 shadow-2xl space-y-6",children:[t.jsxs("div",{className:"flex flex-col items-center text-center",children:[j.success?t.jsx(m,{className:"w-20 h-20 text-emerald-500 mb-4"}):t.jsx(o,{className:"w-20 h-20 text-red-500 mb-4"}),t.jsx("h2",{className:"text-3xl font-black tracking-tight "+(j.success?"text-emerald-500":"text-red-500"),children:j.message})]}),j.data&&t.jsxs("div",{className:"bg-slate-800/50 rounded-2xl p-4 space-y-3 border border-slate-700",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-white",style:{backgroundColor:D},children:t.jsx(l,{className:"w-5 h-5"})}),t.jsxs("div",{className:"text-left flex-1",children:[t.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:"Attendee"}),t.jsx("p",{className:"font-bold text-white",children:j.data.name}),j.data.email&&t.jsx("p",{className:"text-xs text-slate-400",children:j.data.email})]})]}),j.data.type&&t.jsxs("div",{className:"pt-2 border-t border-slate-700",children:[t.jsx("p",{className:"text-xs text-slate-500",children:"Ticket Type"}),t.jsx("p",{className:"text-sm font-bold text-white capitalize",children:j.data.type}),j.data.selfScan&&t.jsx("p",{className:"text-xs text-emerald-400 font-bold mt-1",children:"Self-scan recorded"})]})]}),t.jsx("button",{onClick:()=>v(null),className:"w-full py-4 bg-slate-800 hover:bg-slate-700 rounded-2xl font-bold transition-all text-white",children:"Scan Next"})]})})]}),t.jsxs("div",{className:"p-8 bg-slate-950 border-t border-slate-800 flex items-center justify-around",children:[t.jsxs("button",{className:"flex flex-col items-center gap-2 group",children:[t.jsx("div",{className:"p-4 bg-slate-900 group-hover:bg-slate-800 rounded-2xl border border-slate-800 transition-all text-slate-400",children:t.jsx(u,{className:"w-6 h-6"})}),t.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Switch"})]}),t.jsxs("button",{onClick:()=>!w&&_("test"),className:"relative group",disabled:w,children:[t.jsx("div",{className:"absolute inset-0 rounded-full blur-xl opacity-20 group-hover:opacity-40 transition-opacity",style:{backgroundColor:D}}),t.jsx("div",{className:"w-20 h-20 rounded-full flex items-center justify-center transition-all transform hover:scale-105 active:scale-95 shadow-2xl relative text-white "+(w?"opacity-50 cursor-not-allowed":""),style:{backgroundColor:D},children:t.jsx(x,{className:"w-10 h-10"})})]}),t.jsxs("button",{className:"flex flex-col items-center gap-2 group",children:[t.jsx("div",{className:"p-4 bg-slate-900 group-hover:bg-slate-800 rounded-2xl border border-slate-800 transition-all text-slate-400",children:t.jsx(h,{className:"w-6 h-6"})}),t.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Support"})]})]}),t.jsx("style",{dangerouslySetInnerHTML:{__html:"\n        @keyframes scan-line {\n          0% { top: 0; }\n          100% { top: 100%; }\n        }\n        .animate-scan-line {\n          animation: scan-line 2s linear infinite;\n        }\n      "}})]}):t.jsx("div",{className:"fixed inset-0 bg-slate-950 z-[100] flex items-center justify-center",children:t.jsxs("div",{className:"text-center p-8",children:[t.jsx(o,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Authentication Required"}),t.jsx("p",{className:"text-slate-400 mb-6",children:"Please sign in to use the ticket scanner"}),t.jsx("button",{onClick:()=>E("/dashboard"),className:"px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold",children:"Back to Dashboard"})]})})};export{b as default};
