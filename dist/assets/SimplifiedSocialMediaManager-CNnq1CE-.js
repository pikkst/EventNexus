import{s as e,j as s,am as t,F as a,J as r,I as n}from"./index-b309e1nc.js";import{b as c}from"./charts-0jYrCXCa.js";import{R as o}from"./refresh-cw-hkacKNH8.js";import{C as l}from"./circle-check-CSkpwwxu.js";import{C as i}from"./circle-alert-_cpfBv0g.js";import"./qr-BITZ6EfA.js";const d=({user:d})=>{const[m,x]=c.useState([]),[g,p]=c.useState(!1),[u,h]=c.useState(!1),[b,f]=c.useState(!0),[j,y]=c.useState(null),[N,w]=c.useState(""),[k,v]=c.useState(""),[_,S]=c.useState(""),[I,C]=c.useState("");c.useEffect(()=>{E()},[d.id]);const E=async()=>{try{f(!0),y(null);const{data:s,error:t}=await e.from("social_media_accounts").select("*").eq("user_id",d.id);if(t)throw y(`Error loading accounts: ${t.message}`),t;null==s||s.forEach(e=>{}),x(s||[])}catch(s){y(`Failed to load accounts: ${s instanceof Error?s.message:"Unknown error"}`),x([])}finally{f(!1)}},D=async s=>{if(confirm(`Disconnect ${s}?`))try{const{error:t}=await e.from("social_media_accounts").delete().eq("user_id",d.id).eq("platform",s);if(t)throw t;await E()}catch(t){alert(`Failed to disconnect: ${t instanceof Error?t.message:"Unknown error"}`)}},F=m.find(e=>"facebook"===e.platform),A=m.find(e=>"instagram"===e.platform),$=m.find(e=>"linkedin"===e.platform);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"Social Media Connections"}),s.jsx("p",{className:"text-sm text-slate-400",children:"Connect Facebook, Instagram & LinkedIn to enable automatic post publishing from Marketing Studio"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>E(),disabled:b,className:"flex items-center gap-2 px-3 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 disabled:opacity-50",title:"Refresh accounts",children:s.jsx(o,{className:"w-4 h-4 "+(b?"animate-spin":"")})}),s.jsxs("button",{onClick:()=>h(!u),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[s.jsx(t,{className:"w-4 h-4"}),u?"Hide Setup":"Setup Tokens"]})]})]}),j&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[s.jsxs("p",{className:"text-red-800 text-sm",children:[s.jsx("strong",{children:"‚ö†Ô∏è Error:"})," ",j]}),s.jsx("button",{onClick:()=>E(),className:"mt-2 text-sm px-3 py-1 bg-red-200 text-red-900 rounded hover:bg-red-300",children:"Retry"})]}),b&&s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsx("p",{className:"text-blue-800 text-sm",children:"üîÑ Loading social media accounts..."})}),!b&&0===m.length&&!j&&s.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:s.jsxs("p",{className:"text-yellow-800 text-sm",children:["üì± ",s.jsx("strong",{children:"No connected accounts yet."}),' Click "Setup Tokens" above to connect your Facebook, Instagram and LinkedIn accounts for automated posting.']})}),u&&s.jsxs("div",{className:"bg-gradient-to-br from-purple-100 to-blue-100 border-2 border-purple-300 rounded-xl p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"üîê Manual Token Setup"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-800 mb-1",children:"Facebook App ID"}),s.jsx("input",{type:"text",value:N,onChange:e=>w(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-gray-900",placeholder:"Enter your App ID (e.g., 1527493881796179)"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-800 mb-1",children:"App Secret"}),s.jsx("input",{type:"password",value:k,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-gray-900",placeholder:"Enter your Facebook App Secret"}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Get from: ",s.jsx("a",{href:"https://developers.facebook.com/apps/1527493881796179/settings/basic/",target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline",children:"Facebook Developer Console"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-800 mb-1",children:"User Access Token"}),s.jsx("textarea",{value:_,onChange:e=>S(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent font-mono text-sm text-gray-900",placeholder:"EAAVtP2I4llM..."}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Get from: ",s.jsx("a",{href:"https://developers.facebook.com/tools/explorer/",target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline",children:"Graph API Explorer"})," ",'(Select "EventNexus" app ‚Üí Get Token ‚Üí Get User Access Token)']})]}),s.jsx("button",{onClick:async()=>{var s;if(N&&k&&_){p(!0),C("üîÑ Step 1: Exchanging for long-lived user token...");try{const t=`https://graph.facebook.com/v18.0/oauth/access_token?grant_type=fb_exchange_token&client_id=${N}&client_secret=${k}&fb_exchange_token=${_}`,a=await fetch(t),r=await a.json();if(r.error)throw new Error(`Token exchange failed: ${r.error.message}`);const n=r.access_token;C("‚úÖ Got long-lived user token\nüîÑ Step 2: Fetching Facebook Page...");const c="864504226754704",o=`https://graph.facebook.com/v18.0/${c}?fields=access_token,instagram_business_account&access_token=${n}`,l=await fetch(o),i=await l.json();if(i.error)throw new Error(`Cannot access page: ${i.error.message}`);const m=i.access_token,x=null==(s=i.instagram_business_account)?void 0:s.id;C("‚úÖ Got Facebook Page token\nüîÑ Step 3: Saving to database..."),await e.from("social_media_accounts").delete().eq("user_id",d.id).in("platform",["facebook","instagram"]);const{error:g}=await e.from("social_media_accounts").insert({user_id:d.id,platform:"facebook",account_id:c,account_name:"EventNexus",access_token:m,expires_at:new Date(Date.now()+5184e6).toISOString(),is_connected:!0});if(g)throw new Error(`Failed to save Facebook account: ${g.message}`);if(x){C("‚úÖ Facebook connected\nüîÑ Step 4: Setting up Instagram...");const s=`https://graph.facebook.com/v18.0/${x}?fields=username&access_token=${m}`,t=await fetch(s),a=await t.json(),{error:r}=await e.from("social_media_accounts").insert({user_id:d.id,platform:"instagram",account_id:x,account_name:a.username||"Instagram",access_token:m,expires_at:new Date(Date.now()+5184e6).toISOString(),is_connected:!0});if(r)throw new Error(`Failed to save Instagram account: ${r.message}`);C("‚úÖ Instagram connected!")}else C("‚úÖ Facebook connected!\n‚ö†Ô∏è No Instagram Business Account found on this page.");await E(),setTimeout(()=>{C(""),h(!1),S(""),v("")},3e3)}catch(t){C(`‚ùå Error: ${t instanceof Error?t.message:"Unknown error"}`)}finally{p(!1)}}else alert("‚ùå Please fill in all fields")},disabled:g||!N||!k||!_,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium",children:g?s.jsxs(s.Fragment,{children:[s.jsx(o,{className:"w-5 h-5 animate-spin"}),"Setting up..."]}):s.jsxs(s.Fragment,{children:[s.jsx(l,{className:"w-5 h-5"}),"Auto-Connect Facebook & Instagram"]})}),I&&s.jsx("div",{className:"p-4 rounded-lg "+(I.includes("‚ùå")?"bg-red-50 text-red-800":"bg-blue-50 text-blue-800"),children:s.jsx("pre",{className:"text-sm whitespace-pre-wrap font-mono",children:I})})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"p-6 rounded-xl border-2 "+(F?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"),children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 rounded-lg "+(F?"bg-blue-600":"bg-gray-400"),children:s.jsx(a,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Facebook"}),s.jsx("p",{className:"text-sm text-gray-600",children:F?F.account_name:"Not Connected"})]})]}),F?s.jsx(l,{className:"w-5 h-5 text-green-600"}):s.jsx(i,{className:"w-5 h-5 text-gray-400"})]}),F&&s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Account ID:"}),s.jsx("span",{className:"font-mono text-gray-900",children:F.account_id})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Expires:"}),s.jsx("span",{className:"text-gray-900",children:new Date(F.expires_at).toLocaleDateString()})]}),s.jsx("button",{onClick:()=>D("facebook"),className:"w-full mt-3 px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 text-sm font-medium",children:"Disconnect"})]})]}),s.jsxs("div",{className:"p-6 rounded-xl border-2 "+(A?"bg-pink-50 border-pink-200":"bg-gray-50 border-gray-200"),children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 rounded-lg "+(A?"bg-gradient-to-br from-purple-600 to-pink-600":"bg-gray-400"),children:s.jsx(r,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Instagram"}),s.jsx("p",{className:"text-sm text-gray-600",children:A?`@${A.account_name}`:"Not Connected"})]})]}),A?s.jsx(l,{className:"w-5 h-5 text-green-600"}):s.jsx(i,{className:"w-5 h-5 text-gray-400"})]}),A&&s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Account ID:"}),s.jsx("span",{className:"font-mono text-gray-900",children:A.account_id})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Expires:"}),s.jsx("span",{className:"text-gray-900",children:new Date(A.expires_at).toLocaleDateString()})]}),s.jsx("button",{onClick:()=>D("instagram"),className:"w-full mt-3 px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 text-sm font-medium",children:"Disconnect"})]})]}),s.jsxs("div",{className:"p-6 rounded-xl border-2 "+($?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"),children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-3 rounded-lg "+($?"bg-blue-700":"bg-gray-400"),children:s.jsx(n,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"LinkedIn"}),s.jsx("p",{className:"text-sm text-gray-600",children:$?$.account_name:"Not Connected"})]})]}),$?s.jsx(l,{className:"w-5 h-5 text-green-600"}):s.jsx(i,{className:"w-5 h-5 text-gray-400"})]}),$?s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Account ID:"}),s.jsx("span",{className:"font-mono text-gray-900",children:$.account_id})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Expires:"}),s.jsx("span",{className:"text-gray-900",children:new Date($.expires_at).toLocaleDateString()})]}),s.jsx("button",{onClick:()=>D("linkedin"),className:"w-full mt-3 px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 text-sm font-medium",children:"Disconnect"})]}):s.jsxs("div",{className:"space-y-3 text-sm",children:[s.jsx("p",{className:"text-gray-600",children:"LinkedIn integration coming soon. For now, you can post directly on LinkedIn."}),s.jsx("a",{href:"https://www.linkedin.com/company/eventnexus-eu",target:"_blank",rel:"noopener noreferrer",className:"w-full inline-block text-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium",children:"Visit LinkedIn Page"})]})]})]}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"üìù Setup Instructions:"}),s.jsxs("ol",{className:"text-sm text-blue-800 space-y-1 list-decimal list-inside",children:[s.jsxs("li",{children:["Get your ",s.jsx("strong",{children:"App Secret"})," from Facebook Developer Console"]}),s.jsxs("li",{children:["Get a ",s.jsx("strong",{children:"User Access Token"})," from Graph API Explorer (select EventNexus app)"]}),s.jsx("li",{children:'Click "Setup Tokens" and paste all three values'}),s.jsx("li",{children:'Click "Auto-Connect" - it will fetch Page tokens automatically'}),s.jsx("li",{children:"Tokens are valid for 60 days"})]})]})]})};export{d as SimplifiedSocialMediaManager};
